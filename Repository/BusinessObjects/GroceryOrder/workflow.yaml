# Baseline:
## Generate baseline from XSD
- soya.framework.tools.xmlbeans.XmlSchemaBaseLoader:
    schema: CMM/BOD/GetGroceryOrder.xsd

# Annotations:
## Application Definition:
- soya.framework.tools.xmlbeans.ApplicationAnnotator:
    uri: BusinessObjects/GroceryOrder/oms-application.json

## Apply basic annotation from xlsx mapping sheet:
- soya.framework.tools.xmlbeans.XlsxMappingAnnotator:
    sourceFiles: # load source json from files
      - BusinessObjects/GroceryOrder/requirement/oms.json

    mappingFile: BusinessObjects/GroceryOrder/requirement/GroceryOrder_ERUMS_to_Canonical_Mapping_v1.5.1.xlsx
    mappingSheet: "Mapping OMS to Canonical"
    excludes: # mappings defined but not in this version
      - GetGroceryOrder/GroceryOrderData/GroceryOrderHeader/RetailCustomer/Contact/Address/PhoneNbr
      - GetGroceryOrder/GroceryOrderData/GroceryOrderHeader/RetailCustomer/Contact/PhoneFaxContact/PhoneNbr

## Apply node attribute changes:
- soya.framework.tools.xmlbeans.XmlSchemaNodeAnnotator:
    nodes:
      GetGroceryOrder/DocumentData/Document:
        namespaceURI: http://collab.safeway.com/it/architecture/info/default.aspx
      GetGroceryOrder/DocumentData/DocumentAction:
        namespaceURI: http://collab.safeway.com/it/architecture/info/default.aspx
      GetGroceryOrder/GroceryOrderData/GrocerySubOrder/GroceryOrderDetail/DeliveredItem:
        cardinality: 0-n

## Fix unknown mappings: target paths, source paths and mapping rules...
- soya.framework.tools.xmlbeans.UnknownMappingFixAnnotator:
    fixes:
      ### unknown target paths:
      - unknownType: UNKNOWN_TARGET_PATH
        targetPath: GetGroceryOrder/DocumentData/Document/SystemEnvironmentCd
        fix: GetGroceryOrder/DocumentData/Document/@SystemEnvironmentCd

      - unknownType: UNKNOWN_TARGET_PATH
        targetPath: GetGroceryOrder/GroceryOrderData/GroceryOrderHeader/EditCutoffDttm
        fix: GetGroceryOrder/GroceryOrderData/GroceryOrderHeader/EditCutoffDtTm

      - unknownType: UNKNOWN_TARGET_PATH
        targetPath: GetGroceryOrder/GroceryOrderData/GroceryOrderHeader/RetailCustomer/CustomerAlternateId/sequenceNbr
        fix: GetGroceryOrder/GroceryOrderData/GroceryOrderHeader/RetailCustomer/CustomerAlternateId/@sequenceNbr

      - unknownType: UNKNOWN_TARGET_PATH
        targetPath: GetGroceryOrder/GroceryOrderData/GroceryOrderHeader/RetailCustomer/Contact/PhoneFaxContact/TypeCode
        fix: GetGroceryOrder/GroceryOrderData/GroceryOrderHeader/RetailCustomer/Contact/PhoneFaxContact/@TypeCode

      - unknownType: UNKNOWN_TARGET_PATH
        targetPath: GetGroceryOrder/GroceryOrderData/GroceryOrderHeader/RetailCustomer/Contact/DigitalContact/EmailStatuses/typeCode
        fix: GetGroceryOrder/GroceryOrderData/GroceryOrderHeader/RetailCustomer/Contact/DigitalContact/EmailStatuses/@typeCode

      - unknownType: UNKNOWN_TARGET_PATH
        targetPath: GetGroceryOrder/GroceryOrderData/GroceryOrderHeader/CustomerNotesTxt/typeCode
        fix: GetGroceryOrder/GroceryOrderData/GroceryOrderHeader/CustomerNotesTxt/@typeCode

      - unknownType: UNKNOWN_TARGET_PATH
        targetPath: GetGroceryOrder/GroceryOrderData/GrocerySubOrder/DeliveryInfo/EditCutoffDttm
        fix: GetGroceryOrder/GroceryOrderData/GrocerySubOrder/DeliveryInfo/EditCutoffDtTm

      - unknownType: UNKNOWN_TARGET_PATH
        targetPath: GetGroceryOrder/GroceryOrderData/GrocerySubOrder/DeliveryInfo/DeliverytimeZoneCd
        fix: GetGroceryOrder/GroceryOrderData/GrocerySubOrder/DeliveryInfo/DeliveryTimeZoneCd

      - unknownType: UNKNOWN_TARGET_PATH
        targetPath: GetGroceryOrder/GroceryOrderData/GrocerySubOrder/CustomerService/PhoneFaxContact/TypeCode
        fix: GetGroceryOrder/GroceryOrderData/GrocerySubOrder/CustomerService/PhoneFaxContact/@TypeCode

      - unknownType: UNKNOWN_TARGET_PATH
        targetPath: GetGroceryOrder/GroceryOrderData/GrocerySubOrder/GroceryOrderDetail/DeliveredItem/PromotionalPriceAmt
        fix: GetGroceryOrder/GroceryOrderData/GrocerySubOrder/GroceryOrderDetail/DeliveredItem/PromotionPriceAmt

      - unknownType: UNKNOWN_TARGET_PATH
        targetPath: GetGroceryOrder/GroceryOrderData/GrocerySubOrder/GroceryOrderDetail/FulFilledQty
        fix: GetGroceryOrder/GroceryOrderData/GrocerySubOrder/GroceryOrderDetail/FulfilledQty

      ### unknown source path:
      - unknownType: UNKNOWN_SOURCE_PATH
        targetPath: GetGroceryOrder/GroceryOrderData/GroceryOrderHeader/RetailCustomer/Contact/Address/PostalZoneCd
        fix: customer/address[*]/zipCode


## Generate assignments:
- soya.framework.tools.xmlbeans.AssignmentAnnotator:
    globalVariables:
      - name: VERSION_ID
        type: CHARACTER
        defaultValue: "'1.5.1.053'"
      - name: SYSTEM_ENVIRONMENT_CODE
        type: CHARACTER
        defaultValue: "'PROD'"

    mappingFile: BusinessObjects/GroceryOrder/oms-mappings.properties


# Renderers:
## Print all XPaths:
## Print XPaths Mappings:
- soya.framework.tools.xmlbeans.XPathMappingsRenderer:
    name: XPathMappings
    printUnmapped: true


# Renderers:
## Print XPaths Mappings:
- soya.framework.tools.xmlbeans.XPathMappingsRenderer:
    name: XPathMappings
    printUnmapped: true

## Print XPaths Assignments:
- soya.framework.tools.xmlbeans.XPathAssignmentsRenderer:
    name: XPathAssignments
    printUnmapped: true

## Print Sample XML:
- soya.framework.tools.xmlbeans.SampleXmlRenderer:
    name: SampleXml

## Print node tree in json, indexed by xpath:
- soya.framework.tools.xmlbeans.JsonMappingRenderer:
    name: JsonMapping

## Print Base Annotation, eg. Unknown mappings:
- soya.framework.tools.xmlbeans.BaseAnnotationRenderer:
    name: UnknownMappings
    annotation: UNKNOWN_MAPPINGS

## Print XML construct tree:
- soya.framework.tools.xmlbeans.XmlConstructTreeRenderer:
    name: XmlConstructTree


- soya.framework.tools.xmlbeans.LoopAnalyzeRenderer:
    name: LoopAnalyze

## Print ESQL
- soya.framework.tools.xmlbeans.XmlConstructEsqlRenderer:
    name: ESQL
    brokerSchema: com.abs.osms.deliveryslot
    moduleName: ESED_DELIVERYSLOT_OSMS_CMM_Compute
    inputRootVariable: _inputRootNode
    inputRootReference: InputRoot.JSON.Data

## Print transformation output xml:
- soya.framework.tools.xmlbeans.XmlMessageRenderer:
    inputMessageFile: BusinessObjects/GroceryOrder/requirement/input.json

## Print Avro Schema
- soya.framework.tools.xmlbeans.AvroSchemaRenderer:
    name: AvroSchema

## Print deployment artifacts:
- soya.framework.tools.xmlbeans.OverridePropertiesRenderer:
    name: OverrideBaseline
    template: Templates/override.pr.mustache
    excludes:
      - com.abs.cmnflows.WebServiceResponseValidator
      - com.abs.cmnflows.Audit_Middle
      - com.abs.cmnflows.RetryValidate_Exception

- soya.framework.tools.xmlbeans.OverridePropertiesRenderer:
    name: OverrideDev
    template: Templates/override.dv.mustache
    excludes:
      - com.abs.cmnflows.WebServiceResponseValidator
      - com.abs.cmnflows.Audit_Middle
      - com.abs.cmnflows.RetryValidate_Exception

- soya.framework.tools.xmlbeans.OverridePropertiesRenderer:
    name: OverrideQA
    template: Templates/override.qa.mustache
    excludes:
      - com.abs.cmnflows.WebServiceResponseValidator
      - com.abs.cmnflows.Audit_Middle
      - com.abs.cmnflows.RetryValidate_Exception

- soya.framework.tools.xmlbeans.OverridePropertiesRenderer:
    name: IIBConsole
    template: Templates/iib.mustache
    includeEmpty: true