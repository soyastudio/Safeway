GetGroceryOrder:
  DocumentData:
    Document:
      SystemEnvironmentCd:
        assignment: SYSTEM_ENVIRONMENT_CODE
      DocumentID:
        assignment: "'GROCERY_ORDER'"
      AlternateDocumentID:
        assignment: "'OSMS-EMOM_C02_ORDER-' || CAST(CURRENT_TIMESTAMP AS CHARACTER FORMAT 'YYYYMMddHHmmssSSSSSS')"
      DocumentNm:
        assignment: "'GroceryOrder'"
      CreationDt:
        assignment: CURRENT_TIMESTAMP
      Description:
        assignment: "'GroceryOrderDetail'"
      SourceApplicationCd:
        assignment: "'eRUMS'"
      TargetApplicationCd:
        assignment: "'EDIS'"
      SenderId:
        assignment: $.id
      InternalFileTransferInd:
        assignment: "'Y'"
      DataClassification:
        DataClassificationLevel:
          Code:
            assignment: "'Internal'"
        BusinessSensitivityLevel:
          Code:
            assignment: "'Low'"
        PHIdataInd:
          assignment: "'N'"
        PCIdataInd:
          assignment: "'Y'"
        PIIdataInd:
          assignment: "'Y'"
    DocumentAction:
      ActionTypeCd:
        assignment: "'UPDATE'"
      RecordTypeCd:
        assignment: "'CHANGE'"
  GroceryOrderData:
    GroceryOrderHeader:
      OrderId:
        assignment: $.orderNumber
      OrderCreateTS:
        assignment: $.orderCreatedDate
      CompanyId:
        assignment: $.companyId
      VersionNbr:
        assignment: $.versionNumber
      OrderStatus:
      OrderActionStatus:
        Description:
          assignment: $.messageActionReason
      FulfillingFacility:
        RetailStoreId:
          assignment: $.storeNumber
        BannerCd:
          assignment: $.banner
        MFCInd:
          assignment: "'???'"
        HybridStoreInd:
          assignment: "'???'"
        PremiumStoreInd:
          assignment: "'???'"
        ThirdPartyDeliveryOnlyInd:
          assignment: "'???'"
        ERUMSEnabledInd:
          assignment: "'???'"
      RetailCustomer:
        CustomerNm:
          GivenNm:
            assignment: $.customer.name.firstName
          FamilyNm:
            assignment: $.customer.name.lastName
        Contact:
          - loop:contact://customer.contact[*]/_contact:
              PhoneFaxContact:
                TypeCode:
                  assignment: _contact.type
                PhoneNbr:
                  assignment: _contact.number
          - loop:email://customer.email[*]/_email:
              DigitalContact:
                DigitalAddress:
                  assignment: _email.id
          - loop:address://customer.address[*]/_address:
        ClubCardNbr:
          assignment: $.customer.clubCardNumber
        CustomerPreference:
          - loop:optIn://customer.preference.optIn[*]/_optIn:
              OptInContactNbr:
                assignment: _optIn.id
              OptInInd:
                assignment: _optIn.isOptin
        CustomerSubscription:
          SubscriptionTypeCd:
            assignment: "'???'"
          OptInInd:
            assignment: $.customer.isSubscription
      CurrencyCd:
        assignment: $.orderTotal.currency
      TotalAmt:
        assignment: CAST($.orderTotal.amount AS DECIMAL(10, 2))
      CustomerPayment:
        Tender:
          - loop:paymentDetails://paymentDetails[*]/_paymentDetails:
              TenderId:
                assignment: _paymentDetails.tokenNumber
              TenderTypeCd:
                assignment: _paymentDetails.paymentType
              TenderSubTypeCd:
                assignment: _paymentDetails.paymentSubType
              HolderNm:
                assignment: _paymentDetails.cardHolderName
              ExpireMonthYearTxt:
                assignment: _paymentDetails.cardExpiryMonth
              BillingAddress:
                PostalZoneCd:
                  assignment: _paymentDetails.address.zipCode
              PostalCd:
                assignment: _paymentDetails.zipcode
              Token:
                TokenId:
                  assignment: _paymentDetails.tokenNumber
                TokenTypeCd:
                  assignment: _paymentDetails.paymentType
              Status:
                StatusCd:
                  assignment: _paymentDetails.paymentStatus.status
              RequiredAuthAmt:
                assignment: CAST(_paymentDetails.reqAuthorizationAmount AS DECIMAL(10, 2))
              AuthCd:
                assignment: _paymentDetails.paymentStatus.authorizationCode
              AuthDt:
                assignment: _paymentDetails.paymentStatus.authorizationDate
      CustomerSavings:
        SavingsCategoryType:
          - loop:card_savings://orderTotal.cardSavings[*]/_card_savings:
              SavingsCategoryId:
                assignment: _card_savings.savingsCategoryId
              SavingsCategoryNm:
                assignment: _card_savings.savingsCategoryName
              SavingsAmt:
                assignment: CAST(_card_savings.savingsAmount AS DECIMAL(10, 2))
      OrderRecordDateInfo:
        CreateUserId:
          assignment: $.sourceInfo.enteredBy
      OrderCreatedDeviceType:
        Code:
          assignment: $.sourceInfo.deviceType
      AffiliatePartnerType:
        AffiliatePartnerNm:
          assignment: $.sourceInfo.affiliate.affiliateName
        OrderReferenceTxt:
          assignment: $.sourceInfo.affiliate.affiliateOrderRef
      OrderSourceSystemType:
        Code:
          assignment: $.sourceInfo.source
      GroceryOrderProfileType:
        ProfileType:
          Code:
            assignment: "'???'"
        ProfileValueInd:
          assignment: "'???'"
    GrocerySubOrder:
      - loop:subOrder://subOrders[*]/_subOrder:
          SubOrderNbr:
            assignment: _subOrder.subOrderNumber
          SubOrderActionStatus:
            Description:
              assignment: _subOrder.messageActionReason
          GroceryOrderDetail:
            - loop:orderLine://subOrders[*].orderLines[*]/_orderLine:
                CartLineNbr:
                  assignment: _orderLine.itemPrice.entryId
                ItemId:
                  SystemSpecificItemId:
                    assignment: _orderLine.itemId
                  BaseProductNbr:
                    assignment: "CAST('???' AS DECIMAL(14, 0))"
                  ItemDescription:
                    assignment: _orderLine.itemDescription
                UnitPriceAmt:
                  assignment: CAST(_orderLine.unitPrice.amount AS DECIMAL(14, 4))
                ExtendedUnitPriceAmt:
                  assignment: CAST(_orderLine.itemPrice.extendedPrice AS DECIMAL(14, 4))
                Quantity:
                  assignment: CAST(_orderLine.orderedQuantity AS DECIMAL(14, 4))
                UOM:
                  UOMCd:
                    assignment: _orderLine.unitOfMeasure
                DiscountAllowedInd:
                  assignment: _orderLine.itemPrice.discountAllowed
                RewardAllowedInd:
                  assignment: _orderLine.itemPrice.pointsApplyItem
                SubstitutionType:
                  Code:
                    assignment: _orderLine.substitutionCode
                  Description:
                    assignment: _orderLine.substitutionValue
                CurrencyCd:
                  assignment: _orderLine.unitPrice.currency
                RegulatedItemInd:
                  assignment: _orderLine.isRegulatedItem
                LinkPLUNbr:
                  assignment: _orderLine.itemPrice.linkPluNumber
                CouponPLUNbr:
                  assignment: _orderLine.itemPrice.itemPluNumber
                CustomerOffers:
                  - loop:customer_savings_loop://subOrders[*].orderLines[*].itemPrice.savings[*]/_customer_savings:
                      OfferId:
                        assignment: _customer_savings.offerId
                      OfferSourceType:
                        Code:
                          assignment: _customer_savings.source
                      CustomerRewards:
                        - loop:points_loop://subOrders[*].orderLines[*].itemPrice.savings[*].points[*]/_point:
                            RewardsProgramNm:
                              assignment: _point.programName
                            EarnedQty:
                              assignment: _point.earn
                            UsedQty:
                              assignment: _point.burn
                Department:
                  Code:
                    assignment: _orderLine.itemPrice.department
                WICItemInd:
                  assignment: _orderLine.itemPrice.wic
                DeliveredItem:
                  Item:
                    - loop:fulfilledUpc://subOrders[*].orderLines[*].fulfilledUpc[*]/_fulfilledUpc:
                        UPC:
                          UPCTxt:
                            assignment: _fulfilledUpc.upcId
                  Quantity:
                    assignment: CAST(_orderLine.suppliedQuantity AS DECIMAL(14, 4))
                  UOM:
                    UOMCd:
                      assignment: _orderLine.suppliedQuantityType
                  UnitPriceAmt:
                    assignment: CAST(_orderLine.suppliedUnitPrice.amount AS DECIMAL(14, 4))
                  ItemTaxAmt:
                    assignment: CAST(_orderLine.itemTotalTax AS DECIMAL(14, 4))
                  AppliedDiscountAmt:
                    assignment: CAST(_orderLine.discountsApplied AS DECIMAL(14, 4))
                  CurrencyCd:
                    assignment: _orderLine.suppliedUnitPrice.currency
            - loop:promoCode://subOrders[*].promoCodes[*]/_promoCode:
                PromotionType:
                  Code:
                    assignment: _promoCode.code
                  Description:
                    assignment: _promoCode.description
                PromotionTriggerCd:
                  assignment: _promoCode.pluCode
          ReturnedItem:
            - loop:refundedOrderLine://subOrders[*].refundedOrderLines[*]/_refundedOrderLine:
                Item:
                  ItemDescription:
                    assignment: _refundedOrderLine.itemDescription
                Quantity:
                  assignment: CAST(_refundedOrderLine.refundedQuantity AS DECIMAL(14, 4))
                UOM:
                  UOMCd:
                    assignment: _refundedOrderLine.unitOfMeasure
                UnitPriceAmt:
                  assignment: CAST(_refundedOrderLine.unitPrice.amount AS DECIMAL(14, 4))
                CurrencyCd:
                  assignment: _refundedOrderLine.unitPrice.currency
          FullFillmentType:
            Code:
              assignment: _subOrder.fulfillmentType
          PickupInfo:
            PickupSlot:
              Code:
                assignment: _subOrder.deliveryInfo.pickupInfo.locationId
            PickupSlotType:
              Code:
                assignment: _subOrder.deliveryInfo.pickupInfo.locationType
            DisplayEndDttm:
              assignment: _subOrder.deliveryInfo.slotInfo.lastPickupTime
          DeliveryInfo:
            CustomerType:
              Code:
                assignment: _subOrder.deliveryInfo.deliverySubType
            DeliverySlotId:
              assignment: _subOrder.deliveryInfo.slotInfo.slotId
            DeliverySlotType:
              Code:
                assignment: _subOrder.deliveryInfo.slotInfo.slotType
            DeliveryServiceType:
              Code:
                assignment: _subOrder.deliveryInfo.deliveryServiceType
            SlotPlan:
              Code:
                assignment: _subOrder.deliveryInfo.slotInfo.slotPlan
            StartDttm:
              assignment: _subOrder.deliveryInfo.slotInfo.startTime
            EndDttm:
              assignment: _subOrder.deliveryInfo.slotInfo.endTime
            SlotExpiryDttm:
              assignment: _subOrder.deliveryInfo.slotInfo.endTime
            StageByDttm:
              assignment: _subOrder.deliveryInfo.stageByDateTime
            EditCutoffDttm:
              assignment: _subOrder.deliveryInfo.slotInfo.editingCutoffDate
            CustomerInstructionTxt:
              assignment: _subOrder.deliveryInfo.instructions
          ChargeInfo:
            - loop:charge://subOrders[*].charges[*]/_charge:
                Charge:
                  Code:
                    assignment: _charge.id
                  Description:
                    assignment: _charge.name
                ChargeCategory:
                  Code:
                    assignment: _charge.category
                ChargeAmt:
                  assignment: CAST(_charge.chargeAmount.amount AS DECIMAL(10, 2))
                CurrencyCd:
                  assignment: _charge.chargeAmount.currency
          CustomerService:
            - loop:service_contact://subOrders[*].customerService.contact[*]/_service_contact:
                PhoneFaxContact:
                  PhoneNbr:
                    assignment: _service_contact.number
                  PhonePurposes:
                    PurposeDsc:
                      assignment: _service_contact.subType
